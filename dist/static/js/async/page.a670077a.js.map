{"version":3,"file":"static/js/async/page.a670077a.js","sources":["webpack://lark-bitable-sidebar-format-preview/./src/routes/page.tsx"],"sourcesContent":["import { MarkdownRender, Radio, RadioGroup } from '@douyinfe/semi-ui';\nimport './index.css';\nimport { useEffect, useRef, useState } from 'react';\nimport hljs from 'highlight.js';\nimport { bitable } from '@lark-base-open/js-sdk';\nimport prettier from 'prettier/standalone';\nimport parserBabel from 'prettier/plugins/babel';\nimport parserYaml from 'prettier/plugins/yaml';\nimport parserGraphql from 'prettier/plugins/graphql';\nimport parserHtml from 'prettier/plugins/html';\nimport parserMarkdown from 'prettier/plugins/markdown';\nimport parserEstree from 'prettier/plugins/estree';\nimport parserTypescript from 'prettier/plugins/typescript';\n\nconst parserMap: any = {\n  html: 'html',\n  xml: 'html',\n  markdown: 'markdown',\n  css: 'css',\n  scss: 'css',\n  less: 'css',\n  yaml: 'yaml',\n  graphql: 'graphql',\n  pug: 'pug',\n  json: 'json',\n};\n\nconst Index = () => {\n  const [mode, setMode] = useState('markdown');\n  const [content, setContent] = useState('');\n  const [theme, setTheme] = useState('light');\n  const contentRef = useRef<HTMLElement | null>(null);\n  bitable.bridge.getTheme().then(theme => setTheme(theme.toLowerCase()));\n  // 获取当前打开的表格\n  useEffect(() => {\n    hljs.highlightAll();\n    const off = bitable.base.onSelectionChange(event => {\n      console.log(event.data);\n      if (!event.data.tableId || !event.data.fieldId || !event.data.recordId) {\n        return;\n      }\n      bitable.base\n        .getTable(event.data.tableId)\n        .then(table =>\n          table.getCellString(event.data.fieldId!, event.data.recordId!),\n        )\n        .then(str => {\n          setContent(str);\n        })\n        .catch(e => console.log(e));\n    });\n    const off2 = bitable.bridge.onThemeChange(event => {\n      setTheme(event.data.theme.toLowerCase());\n    });\n    return () => {\n      off();\n      off2();\n    };\n  }, []);\n  useEffect(() => {\n    import(`@public/css/atom-one-${theme}.css`).catch(err => {\n      console.error(`Failed to load theme: ${err}`);\n    });\n  }, [theme]);\n  useEffect(() => {\n    const fn = async () => {\n      if (contentRef.current && mode === 'code') {\n        const result = hljs.highlightAuto(content);\n        console.log(result);\n        let txt = result.value;\n        try {\n          if (parserMap[result.language ?? '']) {\n            txt = await prettier.format(\n              content.replaceAll('<', '&lt;').replaceAll('>', '&gt;'),\n              {\n                parser: parserMap[result.language ?? ''] ?? '',\n                plugins: [\n                  parserBabel,\n                  parserYaml,\n                  parserGraphql,\n                  parserHtml,\n                  parserMarkdown,\n                  parserEstree,\n                  parserTypescript,\n                ],\n              },\n            );\n          }\n        } catch (error) {}\n        contentRef.current.innerHTML = txt;\n      }\n    };\n    fn();\n  }, [content, mode]);\n\n  return (\n    <div className=\"flex flex-col items-center w-screen max-h-screen\">\n      <RadioGroup\n        className=\"flex-shrink-0\"\n        defaultValue={mode}\n        aria-label=\"markdown/code\"\n        type=\"button\"\n        buttonSize=\"large\"\n        onChange={e => setMode(e.target.value)}\n      >\n        <Radio value={`markdown`}>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"streamline--markdown-circle-programming\"></span>\n            markdown\n          </div>\n        </Radio>\n        <Radio value={`code`}>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"fluent--code-circle-32-regular\"></span>\n            code\n          </div>\n        </Radio>\n      </RadioGroup>\n      <div className=\"relative flex flex-grow mb-4 p-4 w-screen text-wrap break-all whitespace-break-spaces overflow-y-auto\">\n        {mode === 'markdown' && (\n          <MarkdownRender className=\"p-4 grow\" raw={content} format=\"md\" />\n        )}\n        {mode === 'code' && (\n          <pre className=\"flex w-full grow\">\n            <code\n              ref={contentRef}\n              className={`grow w-full p-4 text-wrap break-all whitespace-break-spaces ${\n                theme === 'dark' ? 'hljs dark' : 'hljs'\n              }`}\n            ></code>\n          </pre>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Index;\n"],"names":["parserMap","html","xml","markdown","css","scss","less","yaml","graphql","pug","json","Index","mode","setMode","useState","content","setContent","theme","setTheme","contentRef","useRef","bitable","then","toLowerCase","useEffect","hljs","off","event","console","log","data","tableId","fieldId","recordId","table","getCellString","str","catch","e","off2","concat","err","error","fn","current","result","txt","value","language","prettier","replaceAll","parser","plugins","parserBabel","parserYaml","parserGraphql","parserHtml","parserMarkdown","parserEstree","parserTypescript","innerHTML","className","RadioGroup","defaultValue","type","buttonSize","onChange","target","Radio","MarkdownRender","raw","format","ref"],"mappings":"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"}